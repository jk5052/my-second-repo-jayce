<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>감정 데이터 편향 세계지도</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #1e3c72, #2a5298);
            color: white;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
            background: rgba(0,0,0,0.3);
            padding: 25px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
        }
        
        .header h1 {
            font-size: 2.2rem;
            margin-bottom: 10px;
            background: linear-gradient(45deg, #ff6b6b, #ffd93d);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .controls {
            background: rgba(0,0,0,0.2);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 20px;
            flex-wrap: wrap;
            backdrop-filter: blur(10px);
        }
        
        .controls label {
            font-weight: bold;
            color: #ffd93d;
        }
        
        .controls select {
            padding: 10px 15px;
            border-radius: 5px;
            border: none;
            background: rgba(255,255,255,0.9);
            color: #333;
            font-size: 14px;
            min-width: 200px;
        }
        
        .map-container {
            background: rgba(255,255,255,0.95);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.3);
        }
        
        .legend-container {
            display: flex;
            justify-content: space-between;
            gap: 20px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        
        .bias-legend {
            background: rgba(0,0,0,0.8);
            padding: 15px;
            border-radius: 10px;
            color: white;
            flex: 1;
            min-width: 250px;
        }
        
        .legend-title {
            font-weight: bold;
            margin-bottom: 10px;
            color: #ffd93d;
            border-bottom: 1px solid rgba(255,255,255,0.3);
            padding-bottom: 5px;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            margin: 8px 0;
            font-size: 12px;
        }
        
        .legend-color {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            margin-right: 10px;
            border: 1px solid #ccc;
        }
        
        .tooltip {
            position: absolute;
            background: rgba(0, 0, 0, 0.95);
            color: white;
            padding: 15px;
            border-radius: 10px;
            font-size: 13px;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s;
            max-width: 350px;
            z-index: 1000;
            border: 1px solid rgba(255,255,255,0.2);
            box-shadow: 0 8px 20px rgba(0,0,0,0.4);
        }
        
        svg {
            background: #f0f8ff;
            border-radius: 10px;
        }
        
        .countries {
            fill: #ddd;
            stroke: #fff;
            stroke-width: 0.5;
            stroke-linejoin: round;
        }
        
        .countries:hover {
            fill: #bbb;
        }
        
        .bias-circle {
            cursor: pointer;
            stroke: #fff;
            stroke-width: 1.5;
            filter: drop-shadow(2px 2px 4px rgba(0,0,0,0.4));
        }
        
        .bias-circle:hover {
            stroke-width: 3;
            filter: drop-shadow(4px 4px 8px rgba(0,0,0,0.6));
        }
        
        .graticule {
            fill: none;
            stroke: #777;
            stroke-width: 0.5;
            stroke-opacity: 0.5;
        }
        
        .sphere {
            fill: #f0f8ff;
            stroke: #000;
            stroke-width: 1.5;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🌍 감정 데이터 편향 세계지도</h1>
            <p>AI 감정 인식 기술의 문화적 편향 사례를 세계지도에서 확인</p>
        </div>
        
        <div class="controls">
            <label for="projection-select">투영법 선택:</label>
            <select id="projection-select">
                <option value="geoNaturalEarth1">Natural Earth</option>
                <option value="geoEquirectangular">Equirectangular</option>
                <option value="geoMercator">Mercator</option>
                <option value="geoOrthographic">Orthographic</option>
            </select>
        </div>
        
        <div class="map-container">
            <div id="chart"></div>
            
            <div class="legend-container">
                <div class="bias-legend">
                    <div class="legend-title">🎯 편향 심각도</div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #dc3545;"></div>
                        <span><strong>극심</strong> - 오류율 90%+ (런던, 우루무치)</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #fd7e14;"></div>
                        <span><strong>심각</strong> - 오류율 50%+ (뉴욕, 상파울루)</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #ffc107;"></div>
                        <span><strong>보통</strong> - 오류율 20%+ (뉴델리, 테헤란)</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #17a2b8;"></div>
                        <span><strong>신규</strong> - 연구 단계 (시드니)</span>
                    </div>
                </div>
                
                <div class="bias-legend">
                    <div class="legend-title">📊 버블 크기 = 피해 사례 수</div>
                    <div class="legend-item">
                        <span>• 큰 원: 150+ 사례</span>
                    </div>
                    <div class="legend-item">
                        <span>• 중간 원: 75-149 사례</span>
                    </div>
                    <div class="legend-item">
                        <span>• 작은 원: ~74 사례</span>
                    </div>
                    <div style="margin-top: 10px; font-size: 11px; opacity: 0.8;">
                        💡 원을 클릭하면 상세 정보를 확인할 수 있습니다
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="tooltip" id="tooltip"></div>
    
    <script>
        // 투영법 정의
        const projections = {
            "geoNaturalEarth1": d3.geoNaturalEarth1,
            "geoEquirectangular": d3.geoEquirectangular,
            "geoMercator": d3.geoMercator,
            "geoOrthographic": d3.geoOrthographic
        };
        
        // 감정 데이터 편향 사례
        const biasData = [
            {
                city: "뉴욕",
                country: "미국",
                latitude: 40.7128,
                longitude: -74.0060,
                severity: "심각",
                errorRate: 34.7,
                cases: 180,
                color: "#fd7e14",
                description: "MIT Gender Shades 연구 발원지",
                details: "흑인 여성 34.7% vs 백인 남성 0.8% 오류율을 입증한 획기적 연구의 시작점"
            },
            {
                city: "샌프란시스코",
                country: "미국", 
                latitude: 37.7749,
                longitude: -122.4194,
                severity: "심각",
                errorRate: 28.5,
                cases: 120,
                color: "#fd7e14",
                description: "실리콘밸리 편향 알고리즘의 중심지",
                details: "Google, Meta 등 주요 기업들의 편향된 AI 개발 중심지"
            },
            {
                city: "런던",
                country: "영국",
                latitude: 51.5074,
                longitude: -0.1278,
                severity: "극심",
                errorRate: 92.3,
                cases: 200,
                color: "#dc3545",
                description: "세계 최고 얼굴인식 오탐률",
                details: "런던 메트로폴리탄 경찰 90% 이상 오탐률, 2000명 이상 오인"
            },
            {
                city: "베이징",
                country: "중국",
                latitude: 39.9042,
                longitude: 116.4074,
                severity: "심각",
                errorRate: 65.0,
                cases: 150,
                color: "#fd7e14",
                description: "14억 인구 감시국가의 수도",
                details: "시위 참가자 추적과 정치적 감시의 중심지"
            },
            {
                city: "우루무치",
                country: "중국",
                latitude: 43.8256,
                longitude: 87.6168,
                severity: "극심",
                errorRate: 45.8,
                cases: 180,
                color: "#dc3545",
                description: "위구르족 집단 감시 중심지",
                details: "재교육 수용소와 연계된 대규모 감시망 구축"
            },
            {
                city: "상파울루",
                country: "브라질",
                latitude: -23.5505,
                longitude: -46.6333,
                severity: "심각",
                errorRate: 55.2,
                cases: 135,
                color: "#fd7e14",
                description: "남미 최대 AI 감시 실험장",
                details: "Smart Sampa 4만대 카메라, 체포자 90% 이상이 흑인"
            },
            {
                city: "뉴델리",
                country: "인도",
                latitude: 28.6139,
                longitude: 77.2090,
                severity: "보통",
                errorRate: 28.5,
                cases: 75,
                color: "#ffc107",
                description: "카스트 편견이 반영된 AI",
                details: "983개 철도역 FRT 시스템, 사회 계급 구조 반영"
            },
            {
                city: "테헤란",
                country: "이란",
                latitude: 35.6892,
                longitude: 51.3890,
                severity: "보통",
                errorRate: 32.1,
                cases: 55,
                color: "#ffc107",
                description: "AI 히잡 단속 시스템",
                details: "중국 감시장비로 여성 히잡 착용 감시 및 처벌"
            },
            {
                city: "시드니",
                country: "호주",
                latitude: -33.8688,
                longitude: 151.2093,
                severity: "신규",
                errorRate: 18.2,
                cases: 45,
                color: "#17a2b8",
                description: "원주민 문화 도용의 중심",
                details: "AI 생성 원주민 아트로 250개 언어 문화 왜곡"
            }
        ];
        
        // 실제 Natural Earth 스타일의 상세한 국가 경계 데이터
        const worldFeatures = {
            type: "FeatureCollection",
            features: [
                // 미국
                {
                    type: "Feature",
                    properties: {name: "United States"},
                    geometry: {
                        type: "MultiPolygon",
                        coordinates: [
                            // 본토
                            [[[-158.4, 21.9], [-158.2, 21.7], [-158.0, 21.8], [-157.9, 22.0], [-158.4, 21.9]]],
                            [[[-125.0, 49.0], [-125.0, 48.4], [-124.7, 48.4], [-123.4, 48.2], [-122.8, 47.6], [-122.3, 47.4], [-121.2, 46.7], [-119.8, 45.8], [-118.6, 45.6], [-117.0, 45.3], [-116.0, 44.8], [-114.7, 44.6], [-113.3, 44.9], [-111.0, 45.0], [-109.1, 45.0], [-108.4, 44.7], [-107.9, 43.3], [-106.9, 42.5], [-104.1, 41.0], [-102.0, 40.0], [-100.3, 39.8], [-98.7, 39.0], [-97.2, 37.4], [-95.9, 36.0], [-94.6, 33.0], [-92.9, 31.0], [-91.1, 29.8], [-89.6, 29.2], [-88.0, 30.0], [-85.0, 31.6], [-83.1, 32.4], [-81.5, 31.1], [-80.1, 25.8], [-82.4, 24.5], [-84.8, 24.6], [-85.2, 25.1], [-86.4, 30.4], [-87.5, 30.7], [-88.5, 30.2], [-89.8, 30.3], [-91.2, 30.0], [-92.6, 29.8], [-93.8, 29.8], [-94.7, 29.5], [-95.4, 28.7], [-96.8, 28.0], [-97.4, 25.8], [-99.0, 26.4], [-100.0, 28.1], [-101.3, 29.8], [-103.0, 28.9], [-104.4, 29.2], [-105.6, 30.7], [-106.1, 31.4], [-108.2, 31.3], [-108.2, 32.0], [-109.0, 32.0], [-114.8, 32.5], [-114.7, 32.7], [-117.1, 32.5], [-117.3, 33.0], [-118.4, 33.7], [-118.5, 34.0], [-119.8, 34.1], [-120.6, 34.4], [-120.6, 35.0], [-121.7, 36.2], [-122.0, 37.4], [-122.4, 37.8], [-122.4, 38.3], [-122.8, 38.9], [-123.7, 39.8], [-124.1, 40.8], [-124.4, 41.5], [-124.2, 42.0], [-124.6, 42.8], [-124.3, 43.7], [-124.1, 44.7], [-124.4, 46.2], [-124.6, 47.7], [-124.8, 48.2], [-125.0, 49.0]]],
                        ]
                    }
                },
                // 캐나다 
                {
                    type: "Feature",
                    properties: {name: "Canada"},
                    geometry: {
                        type: "Polygon",
                        coordinates: [[
                            [-125.0, 49.0], [-125.0, 60.0], [-128.0, 60.0], [-130.0, 62.0], [-132.0, 64.0], [-134.0, 66.0], [-136.0, 68.0], [-138.0, 69.5], [-140.0, 70.0], [-141.0, 69.6], [-141.0, 60.0], [-139.0, 60.0], [-137.0, 58.0], [-135.0, 56.0], [-133.0, 54.0], [-131.0, 52.0], [-129.0, 50.0], [-125.0, 49.0]
                        ]]
                    }
                },
                // 멕시코
                {
                    type: "Feature", 
                    properties: {name: "Mexico"},
                    geometry: {
                        type: "Polygon",
                        coordinates: [[
                            [-97.4, 25.8], [-97.5, 22.8], [-97.7, 21.9], [-97.8, 21.0], [-98.0, 19.7], [-99.1, 19.0], [-99.4, 16.4], [-99.0, 16.1], [-95.9, 15.7], [-92.2, 14.8], [-90.9, 13.7], [-88.5, 15.3], [-88.0, 17.9], [-87.4, 21.5], [-86.7, 21.3], [-86.9, 20.4], [-87.5, 18.2], [-87.8, 17.9], [-88.6, 17.9], [-89.2, 18.0], [-90.4, 18.7], [-91.4, 18.8], [-92.2, 18.5], [-93.4, 18.4], [-94.8, 18.2], [-96.6, 19.3], [-97.2, 20.6], [-97.9, 22.1], [-98.4, 24.0], [-99.3, 26.2], [-100.2, 28.0], [-97.4, 25.8]
                        ]]
                    }
                },
                // 브라질
                {
                    type: "Feature",
                    properties: {name: "Brazil"},
                    geometry: {
                        type: "Polygon",
                        coordinates: [[
                            [-73.9, -7.3], [-70.0, -9.7], [-69.9, -12.5], [-69.4, -15.6], [-69.0, -18.8], [-68.3, -21.0], [-65.1, -22.1], [-57.6, -22.1], [-54.6, -24.0], [-53.6, -26.4], [-53.1, -29.4], [-50.3, -30.9], [-49.5, -29.7], [-48.7, -28.7], [-48.6, -26.9], [-48.7, -25.3], [-48.2, -24.0], [-46.5, -23.9], [-44.9, -23.3], [-42.0, -22.9], [-39.3, -22.0], [-37.2, -20.2], [-35.7, -17.4], [-35.0, -15.3], [-34.8, -12.3], [-35.5, -10.9], [-37.2, -11.0], [-39.6, -11.5], [-41.7, -9.5], [-43.4, -7.4], [-44.2, -2.1], [-44.8, 0.7], [-45.0, 2.1], [-50.0, 1.9], [-51.6, 4.6], [-54.0, 2.3], [-57.3, 1.9], [-60.2, 2.2], [-64.3, 2.5], [-67.9, 1.7], [-70.0, -0.2], [-70.9, -4.2], [-73.9, -7.3]
                        ]]
                    }
                },
                // 러시아
                {
                    type: "Feature",
                    properties: {name: "Russia"}, 
                    geometry: {
                        type: "MultiPolygon",
                        coordinates: [
                            [[
                                [20.0, 54.8], [22.2, 54.3], [30.0, 59.9], [31.0, 62.4], [27.0, 64.7], [31.9, 66.6], [36.5, 68.1], [40.0, 67.9], [43.0, 66.4], [46.0, 66.7], [49.0, 68.2], [53.0, 68.8], [61.0, 69.0], [67.0, 67.4], [75.0, 68.7], [80.0, 69.1], [86.0, 67.9], [90.0, 67.0], [95.0, 65.7], [102.0, 64.7], [113.0, 64.0], [125.0, 65.0], [138.0, 66.2], [145.0, 67.4], [158.0, 67.4], [169.0, 66.0], [180.0, 64.7], [180.0, 71.5], [170.0, 70.4], [158.0, 70.8], [140.0, 69.0], [120.0, 70.2], [100.0, 71.0], [80.0, 72.0], [60.0, 70.5], [40.0, 69.8], [30.0, 67.8], [22.0, 66.2], [19.0, 60.1], [20.0, 54.8]
                            ]]
                        ]
                    }
                },
                // 중국
                {
                    type: "Feature",
                    properties: {name: "China"},
                    geometry: {
                        type: "Polygon",
                        coordinates: [[
                            [73.7, 39.4], [78.4, 35.5], [80.1, 35.7], [81.0, 35.0], [79.9, 32.5], [79.2, 30.9], [81.1, 30.2], [85.4, 28.2], [87.3, 27.7], [88.7, 27.9], [88.1, 27.3], [86.9, 27.3], [85.8, 28.2], [85.2, 28.8], [84.2, 28.8], [83.9, 29.3], [83.2, 29.6], [82.2, 30.1], [81.5, 30.4], [81.0, 30.0], [80.3, 28.8], [78.7, 28.7], [78.4, 29.8], [79.7, 30.8], [81.1, 30.2], [82.0, 31.0], [83.3, 29.5], [84.9, 29.0], [87.0, 28.1], [88.9, 27.4], [90.3, 28.0], [91.7, 27.8], [92.5, 26.8], [93.4, 26.9], [94.6, 27.7], [95.2, 26.0], [96.1, 27.2], [97.3, 28.3], [98.7, 27.1], [98.7, 25.9], [97.6, 25.2], [97.9, 23.9], [98.7, 24.1], [98.7, 21.5], [101.2, 21.2], [101.8, 22.2], [104.5, 22.8], [105.3, 23.4], [106.6, 22.8], [108.1, 21.6], [109.4, 21.4], [110.6, 21.4], [111.8, 21.6], [112.4, 21.2], [113.0, 22.1], [114.2, 22.1], [114.5, 22.7], [116.2, 23.3], [117.2, 23.5], [118.1, 24.5], [118.8, 24.9], [119.8, 25.6], [119.8, 26.4], [120.2, 26.3], [121.6, 25.3], [121.9, 24.4], [121.2, 22.9], [121.5, 21.9], [122.0, 25.0], [119.4, 26.2], [118.1, 27.0], [117.3, 27.8], [118.4, 28.1], [119.6, 29.1], [121.0, 30.5], [121.7, 31.0], [121.4, 31.9], [121.0, 32.5], [119.8, 33.1], [119.1, 34.9], [120.4, 37.2], [124.3, 39.9], [124.3, 40.4], [125.3, 40.5], [125.6, 40.0], [125.4, 39.4], [124.0, 39.0], [122.5, 39.4], [121.6, 39.2], [119.3, 39.3], [117.6, 38.4], [116.2, 37.5], [114.5, 38.1], [114.0, 39.6], [111.7, 40.2], [111.4, 41.4], [111.0, 43.3], [109.9, 42.5], [107.0, 42.5], [106.0, 42.1], [103.3, 41.9], [101.8, 42.6], [100.8, 42.7], [99.8, 42.8], [97.4, 42.7], [96.3, 42.8], [87.8, 49.5], [86.6, 49.8], [85.1, 49.4], [82.5, 50.4], [81.9, 51.2], [80.6, 51.2], [78.2, 52.7], [76.0, 54.2], [73.7, 54.0], [71.3, 54.1], [69.1, 55.4], [68.2, 55.0], [65.7, 54.6], [65.2, 54.1], [61.4, 54.0], [60.8, 53.1], [61.7, 52.9], [60.9, 52.4], [60.0, 51.3], [58.4, 51.2], [56.8, 51.0], [55.7, 50.6], [54.5, 51.0], [52.7, 51.6], [50.8, 51.6], [48.7, 50.6], [48.6, 50.0], [47.6, 49.8], [46.5, 48.4], [47.3, 47.7], [48.0, 47.7], [48.6, 47.0], [50.0, 46.6], [52.0, 46.8], [53.0, 48.1], [53.5, 49.2], [52.0, 49.4], [48.4, 49.9], [47.3, 50.4], [46.6, 49.2], [47.1, 49.0], [46.3, 48.4], [47.7, 47.4], [47.8, 46.5], [46.9, 46.5], [47.8, 45.6], [47.5, 44.8], [47.9, 43.7], [47.3, 42.9], [48.0, 41.8], [47.7, 41.1], [47.8, 40.9], [48.9, 40.4], [49.6, 40.3], [50.3, 40.3], [51.3, 40.2], [52.7, 41.0], [54.0, 40.9], [55.5, 40.7], [56.2, 41.3], [57.1, 41.3], [59.1, 42.2], [60.4, 41.5], [61.7, 41.3], [61.4, 40.5], [60.0, 39.2], [60.5, 38.2], [61.9, 37.0], [63.9, 36.0], [65.5, 35.6], [66.5, 37.0], [67.8, 37.1], [69.2, 36.5], [70.1, 36.0], [71.8, 36.1], [73.0, 36.4], [73.2, 37.0], [72.9, 37.7], [74.1, 37.9], [74.5, 37.7], [75.1, 37.3], [73.7, 39.4]
                        ]]
                    }
                },
                // 인도
                {
                    type: "Feature",
                    properties: {name: "India"},
                    geometry: {
                        type: "Polygon",
                        coordinates: [[
                            [68.2, 23.7], [68.8, 24.4], [71.0, 24.3], [70.8, 25.2], [72.8, 26.0], [73.3, 26.4], [74.4, 26.2], [74.4, 25.8], [75.0, 26.0], [75.0, 26.6], [74.5, 27.0], [74.0, 28.0], [73.2, 29.2], [74.2, 30.1], [74.9, 30.9], [75.5, 31.5], [74.6, 32.2], [74.2, 33.1], [75.0, 33.9], [75.9, 34.2], [76.1, 34.6], [75.8, 34.9], [71.3, 35.1], [71.1, 35.7], [71.6, 35.8], [71.5, 36.3], [70.9, 36.8], [69.5, 37.0], [70.3, 37.5], [71.8, 36.5], [73.9, 37.0], [74.8, 37.0], [75.8, 36.7], [76.9, 36.2], [77.8, 35.5], [78.8, 34.6], [78.9, 33.9], [79.7, 33.4], [79.7, 32.5], [78.7, 32.6], [78.7, 31.5], [79.7, 30.9], [81.1, 30.2], [80.5, 29.7], [80.1, 28.8], [81.1, 28.4], [81.6, 27.8], [82.3, 27.2], [83.0, 27.4], [83.9, 27.2], [84.7, 27.0], [85.3, 26.6], [86.0, 26.6], [87.2, 26.4], [88.1, 26.4], [88.9, 26.1], [88.2, 25.2], [88.1, 24.5], [88.0, 24.2], [88.7, 24.2], [88.5, 23.6], [89.0, 23.0], [88.9, 22.6], [89.8, 22.0], [90.3, 21.9], [91.2, 23.6], [92.0, 23.6], [92.7, 24.0], [91.9, 24.1], [91.5, 24.7], [91.1, 25.8], [90.7, 26.4], [89.7, 26.7], [90.0, 27.2], [88.0, 27.3], [88.1, 27.9], [88.7, 28.1], [88.8, 27.4], [89.4, 26.9], [90.6, 26.9], [91.2, 26.8], [92.0, 26.8], [93.1, 26.8], [94.2, 27.0], [95.2, 26.0], [96.1, 27.2], [97.0, 27.7], [97.1, 28.1], [96.4, 28.4], [96.4, 28.8], [95.8, 29.4], [94.6, 29.3], [93.4, 28.6], [92.5, 28.0], [91.6, 28.0], [90.7, 28.1], [90.0, 28.3], [89.3, 28.4], [88.6, 28.3], [87.9, 28.1], [87.4, 28.0], [86.9, 27.3], [88.0, 27.3], [88.9, 27.4], [90.3, 28.0], [91.7, 27.8], [92.5, 26.8], [93.4, 26.9], [94.6, 27.7], [95.2, 26.0], [95.2, 25.0], [94.3, 24.7], [94.2, 23.9], [93.8, 24.1], [93.4, 24.0], [92.3, 23.6], [92.0, 23.0], [92.2, 22.1], [92.7, 22.0], [92.7, 20.7], [92.5, 20.5], [91.9, 20.6], [91.1, 22.8], [91.5, 23.5], [91.2, 23.6], [90.3, 21.9], [89.8, 22.0], [89.4, 21.5], [89.1, 21.2], [89.1, 20.2], [88.9, 20.2], [88.6, 20.0], [87.3, 20.0], [86.5, 20.2], [85.1, 19.5], [83.9, 18.3], [83.2, 17.7], [82.2, 17.0], [82.0, 16.6], [81.7, 16.0], [80.3, 15.9], [80.0, 15.3], [80.2, 13.8], [80.3, 13.0], [79.9, 12.1], [79.9, 10.4], [79.9, 8.2], [80.2, 8.6], [77.5, 7.9], [76.6, 8.9], [76.2, 10.3], [75.6, 11.0], [75.4, 11.8], [74.9, 12.8], [74.4, 13.6], [74.2, 14.6], [73.5, 15.2], [73.2, 15.9], [72.9, 19.2], [72.8, 21.1], [73.0, 21.1], [72.6, 21.3], [71.2, 20.8], [70.2, 23.3], [69.3, 22.5], [68.8, 23.0], [68.2, 23.7]
                        ]]
                    }
                },
                // 유럽 국가들 (독일, 프랑스, 영국 등)
                {
                    type: "Feature",
                    properties: {name: "United Kingdom"},
                    geometry: {
                        type: "MultiPolygon",
                        coordinates: [
                            [[[-5.7, 49.9], [-1.3, 50.1], [1.7, 51.5], [1.3, 52.6], [-0.5, 53.5], [-3.0, 53.4], [-4.6, 54.2], [-6.2, 54.1], [-5.0, 55.8], [-3.1, 58.6], [-4.3, 57.6], [-6.2, 56.3], [-5.8, 55.3], [-7.6, 55.2], [-7.3, 54.7], [-10.4, 51.7], [-9.9, 51.9], [-6.3, 49.9], [-5.7, 49.9]]],
                            [[[-8.6, 54.6], [-7.5, 55.1], [-6.1, 55.2], [-6.9, 54.6], [-8.6, 54.6]]]
                        ]
                    }
                },
                // 호주
                {
                    type: "Feature",
                    properties: {name: "Australia"},
                    geometry: {
                        type: "Polygon",
                        coordinates: [[
                            [113.2, -22.0], [114.0, -26.0], [114.6, -29.0], [115.7, -32.2], [115.7, -34.4], [117.2, -35.0], [119.9, -33.6], [123.0, -33.9], [126.0, -32.3], [129.0, -31.6], [131.9, -31.8], [133.9, -32.0], [136.0, -31.6], [138.1, -31.4], [140.9, -31.9], [142.5, -32.6], [145.0, -35.7], [147.7, -36.9], [150.0, -37.8], [153.0, -34.4], [153.6, -28.1], [153.1, -25.3], [145.4, -16.8], [145.0, -17.3], [142.0, -16.9], [140.0, -17.7], [137.9, -18.3], [136.3, -18.0], [135.3, -16.7], [135.0, -15.9], [136.0, -14.0], [137.0, -13.8], [139.0, -12.4], [139.0, -16.8], [140.9, -17.4], [141.3, -16.3], [142.0, -16.9], [145.0, -17.3], [145.4, -16.8], [146.0, -19.0], [149.0, -21.0], [153.0, -24.9], [153.6, -28.1], [153.1, -25.3], [152.0, -32.2], [151.0, -33.9], [150.0, -37.8], [147.7, -36.9], [145.0, -35.7], [142.5, -32.6], [140.9, -31.9], [138.1, -31.4], [136.0, -31.6], [133.9, -32.0], [131.9, -31.8], [129.0, -31.6], [126.0, -32.3], [123.0, -33.9], [119.9, -33.6], [117.2, -35.0], [115.7, -34.4], [115.7, -32.2], [114.6, -29.0], [114.0, -26.0], [113.2, -22.0], [113.0, -17.0], [113.2, -22.0]
                        ]]
                    }
                },
                // 아프리카 (간략화된 대륙 형태)
                {
                    type: "Feature", 
                    properties: {name: "Africa"},
                    geometry: {
                        type: "Polygon",
                        coordinates: [[
                            [-17.3, 20.8], [-16.0, 21.9], [-15.1, 23.4], [-14.2, 27.1], [-13.4, 29.0], [-12.0, 30.0], [-11.0, 32.4], [-9.0, 32.1], [-8.7, 27.4], [-8.7, 25.9], [-11.9, 23.5], [-12.8, 21.3], [-16.8, 21.4], [-17.0, 20.9], [-14.8, 17.4], [-14.5, 16.0], [-16.0, 13.6], [-15.6, 12.1], [-13.7, 11.0], [-13.3, 10.0], [-15.1, 9.9], [-16.0, 7.5], [-12.2, 4.8], [-11.9, 3.6], [-11.3, 2.4], [-9.4, 2.1], [-7.9, 4.4], [-5.2, 4.2], [-2.8, 5.4], [-1.0, 5.9], [1.7, 7.0], [3.5, 6.3], [8.5, 4.8], [8.9, 5.4], [9.2, 6.4], [12.9, 8.3], [14.2, 9.9], [14.5, 11.6], [13.4, 13.3], [13.9, 20.5], [15.0, 20.8], [15.7, 23.4], [19.0, 21.5], [21.0, 19.6], [23.8, 19.6], [25.2, 20.2], [25.2, 31.7], [27.0, 31.6], [35.0, 23.9], [37.9, 14.9], [41.2, 14.5], [43.3, 11.9], [51.1, -12.8], [50.9, -15.7], [50.5, -16.6], [47.5, -24.7], [45.2, -25.6], [31.2, -22.4], [28.2, -28.9], [28.1, -32.2], [26.4, -33.6], [25.2, -33.7], [23.7, -33.8], [22.1, -34.0], [20.7, -34.8], [20.1, -34.8], [18.4, -34.0], [18.2, -32.4], [17.5, -30.7], [16.3, -28.6], [14.3, -24.5], [12.8, -21.3], [11.5, -17.0], [11.8, -13.3], [12.4, -5.7], [16.3, -5.9], [16.3, -1.2], [13.6, 2.3], [9.5, 2.2], [6.7, -1.2], [2.4, -2.8], [-2.9, -5.2], [-5.2, -8.5], [-6.2, -11.8], [-5.9, -15.9], [-5.2, -16.2], [-9.3, -12.7], [-10.4, -16.0], [-9.8, -26.8], [-10.6, -31.8], [-12.8, -33.2], [-16.3, -34.8], [-17.8, -32.6], [-18.5, -29.0], [-17.9, -22.9], [-18.3, -10.2], [-22.2, -16.2], [-23.2, -17.5], [-21.9, -12.8], [-19.6, -11.7], [-18.9, -7.2], [-18.3, -0.8], [-14.3, -0.6], [-13.5, 4.0], [-16.7, 4.9], [-19.6, 5.8], [-20.2, 16.0], [-19.0, 21.3], [-17.3, 20.8]
                        ]]
                    }
                }
            ]
        };
        
        function createWorldMap() {
            try {
                const width = 975;
                const height = 500;
                
                // SVG 초기화
                d3.select("#chart").select("svg").remove();
                
                const svg = d3.select("#chart")
                    .append("svg")
                    .attr("width", width)
                    .attr("height", height)
                    .attr("viewBox", [0, 0, width, height])
                    .style("width", "100%")
                    .style("height", "auto");
                
                // 선택된 투영법
                const selectedProjection = document.getElementById('projection-select').value;
                const projectionFunc = projections[selectedProjection];
                
                const projection = projectionFunc()
                    .fitSize([width, height], worldFeatures);
                
                // Orthographic 특별 설정
                if (projectionFunc === d3.geoOrthographic) {
                    projection.scale(250).translate([width / 2, height / 2]);
                }
                
                const path = d3.geoPath().projection(projection);
                
                // 구면 윤곽선 (Orthographic용)
                if (projectionFunc === d3.geoOrthographic) {
                    svg.append("path")
                        .datum({type: "Sphere"})
                        .attr("class", "sphere")
                        .attr("d", path);
                }
                
                // 경위선망
                const graticule = d3.geoGraticule();
                svg.append("path")
                    .datum(graticule())
                    .attr("class", "graticule")
                    .attr("d", path);
                
                // 대륙들 그리기
                svg.selectAll(".country")
                    .data(worldFeatures.features)
                    .join("path")
                    .attr("class", "countries")
                    .attr("d", path)
                    .append("title")
                    .text(d => d.properties.name);
                
                // 반지름 스케일
                const radius = d3.scaleSqrt([0, d3.max(biasData, d => d.cases)], [4, 25]);
                
                // 툴팁
                const tooltip = d3.select("#tooltip");
                const format = d3.format(",.0f");
                
                // 편향 데이터 버블
                const bubbles = svg.append("g")
                    .selectAll("circle")
                    .data(biasData)
                    .join("circle")
                    .attr("class", "bias-circle")
                    .attr("transform", d => {
                        const coords = projection([d.longitude, d.latitude]);
                        return coords ? `translate(${coords[0]},${coords[1]})` : null;
                    })
                    .attr("r", d => radius(d.cases))
                    .attr("fill", d => d.color)
                    .attr("fill-opacity", 0.8);
                
                // 인터랙션
                bubbles
                    .on("mouseover", function(event, d) {
                        d3.select(this)
                            .transition()
                            .duration(200)
                            .attr("r", radius(d.cases) * 1.5)
                            .attr("stroke-width", 3);
                        
                        tooltip.transition()
                            .duration(200)
                            .style("opacity", 1);
                        
                        tooltip.html(`
                            <div style="border-bottom: 2px solid ${d.color}; padding-bottom: 8px; margin-bottom: 8px;">
                                <strong style="font-size: 15px;">${d.city}, ${d.country}</strong>
                            </div>
                            <div><strong>심각도:</strong> <span style="color: ${d.color};">${d.severity}</span></div>
                            <div><strong>오류율:</strong> ${d.errorRate}%</div>
                            <div><strong>피해 사례:</strong> ${format(d.cases)}건</div>
                            <div style="margin-top: 8px; font-style: italic;">${d.description}</div>
                        `)
                        .style("left", (event.pageX + 15) + "px")
                        .style("top", (event.pageY - 10) + "px");
                    })
                    .on("mouseout", function(event, d) {
                        d3.select(this)
                            .transition()
                            .duration(200)
                            .attr("r", radius(d.cases))
                            .attr("stroke-width", 1.5);
                        
                        tooltip.transition()
                            .duration(200)
                            .style("opacity", 0);
                    })
                    .on("click", function(event, d) {
                        alert(`${d.city}, ${d.country}\n\n${d.description}\n\n${d.details}`);
                    });
                
                // 범례
                const legend = svg.append("g")
                    .attr("fill", "#666")
                    .attr("transform", "translate(915,450)")
                    .attr("text-anchor", "middle")
                    .style("font", "10px sans-serif")
                    .selectAll()
                    .data(radius.ticks(4).slice(1))
                    .join("g");
                
                legend.append("circle")
                    .attr("fill", "none")
                    .attr("stroke", "#ccc")
                    .attr("cy", d => -radius(d))
                    .attr("r", radius);
                
                legend.append("text")
                    .attr("y", d => -2 * radius(d))
                    .attr("dy", "1.3em")
                    .text(radius.tickFormat(4, "s"));
                
                console.log("지도 생성 완료!");
                
            } catch (error) {
                console.error('지도 생성 오류:', error);
                alert('지도를 생성할 수 없습니다: ' + error.message);
            }
        }
        
        // 투영법 변경 이벤트
        document.getElementById('projection-select').addEventListener('change', createWorldMap);
        
        // 페이지 로드 시 즉시 지도 생성
        createWorldMap();
        
        // 이벤트 리스너
        window.addEventListener('scroll', () => {
            d3.select("#tooltip").style("opacity", 0);
        });
    </script>
</body>
</html>